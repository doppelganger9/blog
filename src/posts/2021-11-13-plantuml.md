---
title: Des diagrammes UML dans les articles de ce blog ?
date: 2021-11-13T20:45:00
published: true
description: Parfois pour ajouter une fonctionnalitÃ© d'un intÃ©rÃªt douteux, on doit soulever le capot et aller bien loin ! Voyons cela ensemble...
tags: Svelte, Sapper, Markdown, UML, PlantUML, MDsveX
lang: fr
keywords: mdsvex, mdx, markdown, svelte, sapper, plantUML, uml, sequence diagram, class diagram, remark, rehype, unist
slug: 2021/11/13
thumb:
---

Aujourd'hui un bref article expliquant comment ajouter une nouvelle capacitÃ© Ã  notre blog : Ã§a serait sympa de pouvoir faire des diagrammes UML ?

_NOTE: c'est un article commencÃ© en 2020 avant la migration vers SvelteKit, mais largement simplifiÃ© en 2021. Croyez-moi sur parole ğŸ˜‡. J'avais dÃ» trifouiller le code de MDsveX et le patcher pour qu'il accepte les blocs code de type plantuml. Je constante en 2021 que ce n'est plus nÃ©cessaire, j'ai donc raccourci cet article. En fait il ne reste quasi plus rien Ã  dire... Bonne lecture !_

## Mais, Pourquoi ?

Juste pour l'expÃ©rimentation, bien sÃ»r ğŸ¤£!

Evidemment, sur un blog y'a pas trop d'intÃ©rÃªt pour coller des diagrammes, mais parfois Ã§a peut Ãªtre utile.

J'aime bien expliquer avec des carrÃ©s et des flÃ¨ches quand j'ai un tableau blanc Ã  portÃ©e de main.

## UML 

Comment Ã§a, UML Ã§a sert Ã  rien ?

Non, je suis pas tout Ã  fait d'accord, Ã§a a ses avantages pour clarifier ses idÃ©es, et expliquer visuellement les choses.

Un bon dessin vaut mieux qu'un long discours.

Oui je prends le sens de "design" comme "dessin de conception".

Par contre gÃ©nÃ©rer du code Ã  partir d'UML, la bonne blague.

J'ai vÃ©cu Ã§a au dÃ©but de ma carriÃ¨re en 2002-2006 et Ã§a ne marche pas.

Donc, pour moi dans UML je ne retiens que les diagrammes de sÃ©quence (des traits, des acteurs, des flÃ¨ches) et les diagrammes de classes (pour visualiser les liens entre objets.)

## PlantUML

Donc habituellement, au boulot, je prÃ©conise PlantUML parceque OK, je veux vien faire de l'UML, mais pas question d'installer un gros logiciel pour Ã§a : un bout de texte et Ã§a suffit.

Avec PlantUML, on peut rechercher/remplacer, copier-coller, et appliquer des styles de rendu, etc. C'est hyper souple et Ã§a se lit sans avoir besoin de gÃ©nÃ©rer un rendu image.

Exemple: 

```
Truc --> bidule : truc appelle bidule
```

On voit bien qu'il y a une flÃ¨che en "_ascii-art_", non ? 

HÃ© bien PlantUML se contente de tracer des carrÃ©s et des flÃ¨ches Ã  partir de Ã§a.

```plantuml diagramme simpliste
Truc --> bidule : truc appelle bidule
```

Attends une minute... tu vois cette image ğŸ‘†ğŸ» ? Justement, ce blog l'a gÃ©nÃ©rÃ©e Ã  partir du code prÃ©cÃ©dent !

En vrai, voilÃ  ci-dessous le bloc de code Markdown exact avec `plantuml` en langage, tout ce qui suit ("diagramme simpliste") sera collÃ© dans l'attribut `alt` de l'image gÃ©nÃ©rÃ©e, pour l'accessibilitÃ© (a11y) :

````md exemple de code markdown pour un diagramme PlantUML
```plantuml diagramme simpliste
Truc --> bidule : truc appelle bidule
```
````

## Ajouter des diagrammes PlantUML 

Il existe de nombreux plugin, j'ai choisi celui-lÃ  : https://github.com/akebifiky/remark-simple-plantuml

Ce plugin transforme un noeud Markdown de type "code" en noeud "image" en construisant une url spÃ©ciale.

Contrairement Ã  ce qui est dit sur le README, si comme pour ce blog vous publiez via `sveltekit build` avec le `static adapter` (anciennement `sapper export`), inutile de l'installer en dÃ©pendance principale : 

`npm install --save-dev @akebifiky/remark-simple-plantuml`

### Pipeline MDsveX avec Remark

[MDsveX](https://mdsvex.com) utilise [Remark](https://github.com/remarkjs/remark) et [Rehype](https://github.com/rehypejs/rehype) pour sa pipeline de transformation de MarkDown+Svelte vers Svelte classique (avec Script + CSS + HTML).

Remark et Rehype se basent Ã  leur tour sur [UNIST](https://github.com/syntax-tree/unist), UNIversal Syntax Tree.

Vous m'en direz tant !

Bon, en fait il suffit d'ajouter un plugin Remark dans notre configuration `mdsvex.config.js` elle-mÃªme importÃ©e dans `svelte.config.js`

```js
import plantuml from "@akebifiky/remark-simple-plantuml"
//...

  remarkPlugins: [
    //...
    [plantuml, { baseUrl: "https://www.plantuml.com/plantuml/svg" }],
    //...
  ]
```

Ã  partir de lÃ , quand MDsveX va transformer les articles Markdown en composants Svelte, il va passer les plugins Remark et Rehype pour modifier les contenus. Donc si on met un bloc de code avec le langage typÃ© `plantuml`, cela va dÃ©clencher notre plugin dÃ©diÃ©, qui va faire son boulot de le transformer en une URL qui a son tour nous affichera un "joli" dessin au lieu du texte en ascii.

VoilÃ .

Tout ceci est visible sur le code du blog sur GitHub (si vous venez du futur, faudra remonter un peu si je migre encore le socle du blog d'ici lÃ  ğŸ˜œ).

## Conclusion

> Dans cet article on a vu comment ajouter la gÃ©nÃ©ration de diagramme de sÃ©quence pour briller en comitÃ© d'architecture.
>
> Comme UML c'est du sÃ©rieux, pas de GIF ou d'images rigolotes. C'est aussi le premier article en franÃ§ais, on sent que je suis plus Ã  l'aise, non ?
>
> Si vous avez des questions sur ~~UML~~ les dessins avec des boites et des flÃ¨ches, SvelteKit, MDsveX, ou juste pour faire coucou ou dire merci, [mes DMs sont ouverts sur Twitter](https://twitter.com/doppelganger9) !

ğŸ‘‹
